{"version":3,"sources":["../../../../src/snake-game/models/snake-state.model.js"],"names":[],"mappings":"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","file":"snake-state.model.es5.js","sourcesContent":["'use strict';\r\nangular.module('snake')\r\n  .factory('snakeState', snakeStateFactory);\r\n\r\nfunction snakeStateFactory($rootScope, gameState, snakeByteConfig) {\r\n  var service = {\r\n    segments: [], //x,y,direction, corner (bool)\r\n    increaseAmt: 5,\r\n    advanceInterceptors: [hitEdge, hitSegment],\r\n    length: 10,\r\n    init: init,\r\n    getCornerClass: getCornerClass,\r\n    increaseLength: increaseLength,\r\n    removeLast: removeLast,\r\n    advance: advance\r\n  };\r\n\r\n  return service;\r\n\r\n  function init() {\r\n    var startPos = snakeByteConfig.getStartPos();\r\n\r\n    service.segments.length = 0;\r\n\r\n    startPos[3] = '';\r\n    service.segments.push(startPos);\r\n  }\r\n\r\n  function increaseLength() {\r\n    service.length = service.length + service.increaseAmt;\r\n  }\r\n\r\n  function removeLast() {\r\n    if (service.segments.length >= service.length) {\r\n      service.segments.pop();\r\n    }\r\n  }\r\n\r\n  function advance() {\r\n    var currentCoords = service.segments[0];\r\n    var nextAdvance = gameState.getNextAdvance();\r\n    var nextCoords = [];\r\n    var event;\r\n\r\n    nextCoords[0] = currentCoords[0] + nextAdvance[0]; //x\r\n    nextCoords[1] = currentCoords[1] + nextAdvance[1]; //Y\r\n    nextCoords[2] = nextAdvance[2]; //direction string\r\n    nextCoords[3] = 'head'; //corner class\r\n\r\n    event = $rootScope.$broadcast('beforeAdvance', nextCoords);\r\n\r\n\r\n\r\n    if (event.defaultPrevented) {\r\n      gameState.crash();\r\n      return;\r\n    }\r\n\r\n    service.getCornerClass(nextCoords[2]);\r\n\r\n    service.segments.unshift(nextCoords);\r\n\r\n\r\n    service.removeLast();\r\n\r\n  }\r\n\r\n  function getCornerClass(nextPos) {\r\n\r\n    if (nextPos !== service.segments[0][2]) {\r\n      service.segments[0][3] = 'corner ' + service.segments[0][2] + '-' + nextPos;\r\n    } else {\r\n      service.segments[0][3]= '';\r\n    }\r\n\r\n  }\r\n\r\n  // function beforeAdvance(nextX, nextY) {\r\n  //   var length = service.advanceInterceptors.length;\r\n  //   var result;\r\n  //\r\n  //   for (var i = 0; i < length; i = i + 1) {\r\n  //     result = service.advanceInterceptors[i](nextX, nextY);\r\n  //\r\n  //     if (result === false) {\r\n  //       return false; //crash\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  function hitEdge(nextX, nextY) {\r\n    if (nextX < 0 || nextX > (snakeByteConfig.gridWidth - 1)) {\r\n      return false;\r\n    }\r\n\r\n    if (nextY < 0 || nextY > (snakeByteConfig.gridHeight - 1)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function hitSegment(nextX, nextY) {\r\n    var length = service.segments.length;\r\n\r\n    for (var i = 0; i < length; i = i + 1) {\r\n      if (service.segments[i][0] === nextX && service.segments[i][1] === nextY) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}